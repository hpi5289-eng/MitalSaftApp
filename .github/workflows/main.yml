name: Build Android APK

on: workflow_dispatch

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Fix project structure
      run: |
        # Check if we're in correct directory
        echo "Current directory: $(pwd)"
        echo "Files:"
        ls -la
        echo ""
        echo "Android files:"
        ls -la android/ 2>/dev/null || echo "No android folder"
        
    - name: Setup JDK 11 (Android के लिए बेहतर)
      uses: actions/setup-java@v4
      with:
        java-version: '11'
        distribution: 'temurin'
        
    - name: Fix permissions and build
      run: |
        # Gradlew fix
        if [ -f "gradlew" ]; then
          sed -i 's/\r$//' gradlew
          chmod +x gradlew
          echo "✅ Fixed gradlew"
        fi
        
        # Try different build commands
        echo "Trying build..."
        ./gradlew clean || echo "Clean failed, continuing..."
        ./gradlew :app:assembleDebug --stacktrace || echo "Build failed with stacktrace"
        
    - name: Check build results
      run: |
        find . -name "*.apk" -type f 2>/dev/null | head -5 || echo "No APK files found"
